## Telegram Mini‑CRM for Order Management

Этот репозиторий содержит черновой вариант мини‑CRM‑системы для управления
заказами с использованием Google Sheets в качестве базы данных и
Telegram‑мини‑приложения (WebApp) в качестве пользовательского интерфейса.

### Структура проекта

- **bot.py** – (удалён) бот не входит в данный репозиторий, так как
  предполагается использование уже существующего бота Telegram. Вам
  потребуется самостоятельно создать кнопку с `web_app` в настройках
  вашего бота, указывающую на URL деплой‑версии этого приложения.
- **app.py** – Flask‑приложение, которое реализует WebApp для Telegram.
  Оно отдаёт HTML‑страницы и REST‑API для создания и просмотра
  заказов. В мини‑приложении можно оформить новый заказ,
  просмотреть заказы по статусам и изменить статус (в зависимости от
  роли пользователя).
- **sheets.py** – модуль для взаимодействия с Google Sheets. Содержит
  функции для добавления новой позиции заказа, получения списка
  заказов и обновления статуса. Требует файла
  `credentials.json`, полученного из Google Cloud Console, и
  идентификатора электронной таблицы.
- **static/** и **templates/** – директории с файлами фронтенда:
  HTML‑шаблоны и стили JavaScript для динамического добавления
  товаров в заказ.

### Предварительные требования

* Python ≥ 3.9
* Установленные библиотеки из `requirements.txt`:
  `flask`, `google‑api‑python‑client`, `google‑auth‑httplib2`,
  `google‑auth‑oauthlib`, `python‑dotenv`.
* Созданный бот в Telegram и полученный токен.
* Включённые Google Drive API и Google Sheets API, а также
  `credentials.json` в корне проекта. В таблице Google следует создать
  лист `Orders` со следующими заголовками (каждая строка – один
  товар заказа):

  ```
  ID заказа | Статус | Дата заказа | Артикул | Канал продаж |
  Поставщик | Фото | Количество | Сумма заказа | Сумма закупа |
  % | Доп. затраты | Прибыль | Начисления | ФИО | Телефон |
  Мессенджер | Адрес доставки | Логистика | Комментарий
  ```

### Как запустить локально

1. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```
2. Задайте переменные окружения (можно создать файл `.env`):
   - `GOOGLE_SHEETS_ID` – идентификатор таблицы Google.
   - `GOOGLE_DRIVE_FOLDER_ID` – идентификатор папки Google Drive для фото (опционально).
   - `SECRET_KEY` – секретный ключ Flask.
   - `WEBAPP_URL` – URL, по которому приложение будет доступно (при развёртывании).
3. Запустите Flask‑сервер:

   ```bash
   python app.py
   ```
4. Запустите Telegram‑бота:
   В данном репозитории нет бота. Используйте своего существующего
   бота. Добавьте в него кнопку с `web_app`, указывающую на `WEBAPP_URL`.

### Развёртывание

Для круглосуточной работы мини‑приложения можно использовать
облачные платформы вроде Vercel, Railway, Render или Heroku. В
корне репозитория находится файл `vercel.json`, позволяющий
развернуть приложение на Vercel. Не забудьте задать переменные
окружения в настройках проекта. После деплоя скопируйте URL (например,
`https://your-app.vercel.app`) и добавьте его в кнопку вашего Telegram‑бота
с помощью `web_app`.
